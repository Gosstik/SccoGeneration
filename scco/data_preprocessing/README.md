# Микросервис предобработки

Осуществляет принятие сообщений от парсер-бота, их предобработку и передачу ML-сервису.

Терминология: заказчик (customer) - пользователь сервиса генерации КП, а клиент (client) - его потенциальный клиент;
тот, кому пользователь сервиса отправляет КП.

## Организация кода

Точка входа - файл `data_preprocessing.py`. В нём происходит подключение к RabbitMQ и инициализация
пайплайна предобработки.

Пайплайн реализован как класс `PreprocessingPipeline` (в `pipeline.py`), запускающий последовательно
стадии предобработки, которые также реализованы как классы (в `pipeline.py`). Каждая стадия пайплайна
наследуется от абстрактного класса `Operation` (callable, осуществляющий преобразование Pandas DataFrame)

В файле `rabbit_rpc.py` реализованы запросы к сервису с БД.

## Запуск

Запуск микросервиса должен производиться через `docker compose` в родительской папке.

При создании docker-контейнера по `Dockerfile` устанавливаются зависимости из `requirements.txt`, все файлы проекта копируются в контейнер, и запускается `data_preprocessing.py`

## Этапы предобработки

См. файл `pipeline.py`, конструктор класса `PreprocessingPipeline`.

## Редактирование/настройка этапов предобработки

Пайплайн предобработки определяется в `pipeline.py` в классе `PreprocessingPipeline`, в конструкторе:
устанавливается `self.pipeline` в виде списка пар (название этапа, этап - экземпляр `Operation`).
Если нужно поменять порядок этапов, добавить или убрать - это делается здесь.

Пайплайн использует несколько чёрных и белых списков, они хранятся в папке `resources` в виде txt-файлов.
Одна строка файла - один элемент списка.

Некоторые настройки устанавливаются в начале файла `config.py`.

## Запуск тестов

`python3 run_tests.py`
